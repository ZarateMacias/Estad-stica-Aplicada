---
title: "Estadística Descriptiva. Gráficas Variables Cuantitativa"
format: 
  html:
    grid: 
      body-width: 950px
editor: visual
lang: es
---

```{r}
#| code-fold: true
#| warning: false
#| message: false

library(tidyverse)
library(sf)          # Para datos espaciales
library(viridis)     # Para paletas de colores
library(janitor)     # Para limpiar nombres de columnas
library(scales)      # Para mejorar ejes en gráficos

```

# Datos espaciales de Michoacán

```{r municipios}
#| code-fold: true
#| fig-width: 7
#| fig-align: center

municipios_michoacan <- st_read("C:/Users/Hecto/OneDrive/Documentos/Estdística_Aplicada/data/datos", options = "ENCODING=LATIN1", quiet = TRUE)

# Crear mapa de municipios de Michoacán
mapa_municipios <- ggplot(municipios_michoacan) +
  geom_sf(fill = "lightcoral", color = "white", size = 0.3) +
  labs(
    title = "Municipios de Michoacán",
    subtitle = paste("Total de municipios:", nrow(municipios_michoacan)),
    caption = "Fuente: INEGI - Marco Geoestadístico"
  ) +
  theme_void() +
  theme(
    plot.title = element_text(size = 16, face = "bold"),
    plot.subtitle = element_text(size = 12),
    plot.caption = element_text(size = 10)
  )

print(mapa_municipios)
```

# Fuente de datos: INEGI

**Enlace de descarga**: https://inegi.org.mx/app/descarga/

Buscar: Estado. Seleccionar: Programas \> Censos y Conteos de Población y Vivienda \> 2020 \> Indicadores 1900-2020 y descargar el archivo CSV correspondiente a Michoacán.

# Lectura de datos

Carguemos los datos de población y vivienda para el año 2020, filtrando por algunos indicadores relevantes:

-   Edad mediana
-   Población total
-   Porcentaje de la población derechohabiente en el IMSS
-   Porcentaje de viviendas con electricidad
-   Porcentaje de viviendas particulares habitadas que disponen de Internet

```{r}
#| code-fold: true
#| warning: false
#| message: false

datos_total <- read_csv("C:/Users/Hecto/OneDrive/Documentos/Estdística_Aplicada/data/datos/cpv_16_csv.zip", na = c("ND"))

datos_total <- datos_total |> filter(año == 2020)

datos_seleccion <- datos_total |> 
  filter(indicador %in% c("Edad mediana", "Población total", 
                          "Porcentaje de la población derechohabiente en el IMSS", 
                          "Porcentaje de viviendas con electricidad",
                          "Porcentaje de viviendas particulares habitadas que disponen de Internet"), 
         desc_municipio != "Estatal") |> 
  select(desc_municipio, indicador, valor)
```

Cambiamos el formato de los datos para que cada indicador sea una columna separada, facilitando el análisis posterior.

```{r}
#| code-fold: true
#| warning: false
#| message: false

datos <- datos_seleccion |>
    pivot_wider(names_from = indicador, values_from = valor) 

datos <- datos |> 
  clean_names() 

datos <- datos |> 
  mutate(NOMGEO = desc_municipio)
```

# Estadísticas descriptivas

Resumen numérico de las variables cuantitativas:

```{r}
#| code-fold: true

summary(datos)
```

Unimos los datos geográficos de los municipios de Michoacán con los datos de población y vivienda:

```{r}
#| code-fold: true

datos <- left_join(municipios_michoacan, datos)
```

# Edad (Mediana)

```{r}
#| code-fold: true
#| fig-width: 8
#| fig-align: center

ggplot(datos) +
  geom_sf(aes(fill = edad_mediana), color = "white", size = 0.1) +
  scale_fill_viridis_c(
    name = "Edad (mediana)"
  ) +
  labs(
    title = "Edad (mediana) de los Municipios de Michoacán",
    caption = "Fuente: INEGI - Marco Geoestadístico"
  ) +
  theme_void() +
  theme(
    plot.title = element_text(size = 16, face = "bold"),
    plot.subtitle = element_text(size = 12),
    plot.caption = element_text(size = 10),
    legend.position = "right"
  )
```

## Histograma

```{r}
#| code-fold: true
#| fig-width: 7
#| fig-align: center

ggplot(datos) +
  geom_histogram(aes(edad_mediana), color="black", fill = "olivedrab", 
                 boundary=min(datos$edad_mediana, na.rm = TRUE), binwidth = 2) +
  labs(
    title = "Distribución de la Edad",
    x = "Edad (años)", y = "Frecuencia"
  ) +
  theme_bw()+
  theme(
    legend.title = element_text(size=13, face="bold"),
    legend.text = element_text(size=13),
    plot.title = element_text(size=15, face="bold"),
    plot.subtitle = element_text(size=13),
    axis.text.x=element_text(size=12),
    axis.text.y=element_text(size=12),
    axis.title.x = element_text(face="bold", size=13),
    axis.title.y = element_text(face="bold", size=13)
  )
```

## Gráfica de densidad

```{r}
#| code-fold: true
#| fig-width: 7
#| fig-align: center

ggplot(datos) +
  geom_density(aes(edad_mediana), color="black", fill = "firebrick", alpha=0.6) +
  labs(
    title = "Distribución de la Edad",
    x = "Edad (años)", y = "Densidad"
  ) +
  theme_bw()+
  theme(
    legend.title = element_text(size=13, face="bold"),
    legend.text = element_text(size=13),
    plot.title = element_text(size=15, face="bold"),
    plot.subtitle = element_text(size=13),
    axis.text.x=element_text(size=12),
    axis.text.y=element_text(size=12),
    axis.title.x = element_text(face="bold", size=13),
    axis.title.y = element_text(face="bold", size=13)
  )
```

## Boxplot

```{r}
#| code-fold: true
#| fig-width: 7
#| fig-align: center

ggplot(data = datos, aes(x = "", y = edad_mediana)) +
    geom_boxplot(
    fill = "#4A90E2",
    color = "#2C5F7A",
    alpha = 0.8,
    outlier.color = "#E74C3C",
    outlier.size = 2.5,
    outlier.alpha = 0.7,
    width = 0.5,
    notch = TRUE,
    notchwidth = 0.7
  ) +
  geom_jitter(alpha = 0.3, color = "#34495E", size = 1.5, width = 0.1) +
  scale_y_continuous(breaks = pretty_breaks(n = 8), 
                     labels = function(x) paste(x, "años")) +
  labs(title = "Distribución de la Edad (mediana)", 
  subtitle = "Población del Estado de Michoacán",
  y = "Edad (años)",
  x = "")+
  theme_bw()+
  theme(
    legend.title = element_text(size=13, face="bold"),
    legend.text = element_text(size=13),
    plot.title = element_text(size=15, face="bold"),
    plot.subtitle = element_text(size=13),
    axis.text.x=element_text(size=12),
    axis.text.y=element_text(size=12),
    axis.title.x = element_text(face="bold", size=13),
    axis.title.y = element_text(face="bold", size=13),
    panel.grid.major.y = element_line(color = "#ECF0F1", linewidth = 0.5,
      linetype = "dashed"),
    panel.grid.minor.y = element_blank(),
    panel.grid.major.x = element_blank(),
    panel.background = element_rect(fill = "#FAFAFA", color = NA),
    plot.background = element_rect(fill = "white", color = NA)
  )
```

## Gráfico de violín

```{r}
#| code-fold: true
#| fig-width: 7
#| fig-align: center

ggplot(data = datos, aes(x = "", y = edad_mediana)) +
    geom_violin(fill = "#4A90E2", color = "#2C5F7A", alpha = 0.8,
    trim = FALSE,
    scale = "width", width = 0.8, linewidth = 0.8) +
    geom_boxplot(width = 0.15, fill = "white", color = "#2C5F7A", alpha = 0.9,
    outlier.color = "#E74C3C", outlier.size = 1.5, outlier.alpha = 0.8, 
    notch = FALSE) +
  stat_summary(fun = median, geom = "point", shape = 21, size = 3, fill = "white",
  color = "#2C5F7A", stroke = 1.5) +
  geom_jitter(alpha = 0.2, color = "#34495E", size = 0.8, width = 0.05) +
  scale_y_continuous(breaks = pretty_breaks(n = 8), 
                     labels = function(x) paste(x, "años")) +
  labs(title = "Distribución de la Edad (mediana)", 
  subtitle = "Población del Estado de Michoacán",
  y = "Edad (años)",
  x = "")+
  theme_bw()+
  theme(
    legend.title = element_text(size=13, face="bold"),
    legend.text = element_text(size=13),
    plot.title = element_text(size=15, face="bold"),
    plot.subtitle = element_text(size=13),
    axis.text.x=element_text(size=12),
    axis.text.y=element_text(size=12),
    axis.title.x = element_text(face="bold", size=13),
    axis.title.y = element_text(face="bold", size=13),
    panel.grid.major.y = element_line(color = "#ECF0F1", linewidth = 0.5,
      linetype = "dashed"),
    panel.grid.minor.y = element_blank(),
    panel.grid.major.x = element_blank(),
    panel.background = element_rect(fill = "#FAFAFA", color = NA),
    plot.background = element_rect(fill = "white", color = NA)
  )
```

## Q-Q Plot (comparación de cuantiles)

```{r}
#| code-fold: true
#| fig-width: 7
#| fig-align: center

ggplot(data = datos, aes(sample = edad_mediana)) +
    stat_qq(color = "#4A90E2", size = 2, alpha = 0.7) +
    stat_qq_line(color = "#E74C3C", linewidth = 1, linetype = "dashed") +
    scale_x_continuous(name = "Cuantiles Teóricos (Distribución Normal)",
    breaks = pretty_breaks(n = 6)) +
    scale_y_continuous(name = "Cuantiles Muestrales (Edad mediana)",
    breaks = pretty_breaks(n = 6),
    labels = function(x) paste(x, "años")) +
    labs(title = "Gráfico Q-Q para Normalidad",
    subtitle = "Edad Mediana - Población Michoacán") +
    theme_bw()+
    theme(
    legend.title = element_text(size=13, face="bold"),
    legend.text = element_text(size=13),
    plot.title = element_text(size=15, face="bold"),
    plot.subtitle = element_text(size=13),
    axis.text.x=element_text(size=12),
    axis.text.y=element_text(size=12),
    axis.title.x = element_text(face="bold", size=13),
    axis.title.y = element_text(face="bold", size=13),
    panel.grid.major.y = element_line(color = "#ECF0F1", linewidth = 0.5,
      linetype = "dashed"),
    panel.grid.minor.y = element_blank(),
    panel.grid.major.x = element_blank(),
    panel.background = element_rect(fill = "#FAFAFA", color = NA),
    plot.background = element_rect(fill = "white", color = NA)
  )
```

## Dot Plot (Gráfico de puntos)

```{r}
#| code-fold: true
#| fig-width: 7
#| fig-height: 16
#| fig-align: center

ggplot(data = datos, aes(x = edad_mediana, y = reorder(NOMGEO, edad_mediana))) +
  geom_point(color = "#4A90E2", size = 3, alpha = 0.8) +
  geom_segment(aes(x = 0, xend = edad_mediana, y = NOMGEO, yend = NOMGEO),
    color = "#BDC3C7", size = 0.5, alpha = 0.7) +
  scale_x_continuous(
    name = "Edad (años)",
    breaks = pretty_breaks(n = 6),
    expand = expansion(mult = c(0, 0.1))) +
  scale_y_discrete(
    name = "Municipios",
    expand = expansion(mult = c(0.01, 0.01))
  ) +
  labs(
    title = "Dot Plot - Edad (mediana) por Municipio",
    subtitle = "Estado de Michoacán") +
  theme_bw()+
    theme(
    legend.title = element_text(size=13, face="bold"),
    legend.text = element_text(size=13),
    plot.title = element_text(size=15, face="bold"),
    plot.subtitle = element_text(size=13),
    axis.text.x=element_text(size=12),
    axis.text.y=element_text(size=9),
    axis.title.x = element_text(face="bold", size=13),
    axis.title.y = element_text(face="bold", size=13),
    panel.grid.major.y = element_line(color = "#ECF0F1", linewidth = 0.5,
      linetype = "dashed"),
    panel.grid.minor.y = element_blank(),
    panel.grid.major.x = element_blank(),
    panel.background = element_rect(fill = "#FAFAFA", color = NA),
    plot.background = element_rect(fill = "white", color = NA)
  )
```

# Derechohabientes IMSS (%)

```{r}
#| code-fold: true
#| fig-width: 8
#| fig-align: center

ggplot(datos) +
  geom_sf(aes(fill = porcentaje_de_la_poblacion_derechohabiente_en_el_imss), 
          color = "white", size = 0.1) +
  scale_fill_viridis_c(
    name = "IMSS (%)"
  ) +
  labs(
    title = "Derechohabientes IMSS (%) de los Municipios de Michoacán",
    caption = "Fuente: INEGI - Marco Geoestadístico"
  ) +
  theme_void() +
  theme(
    plot.title = element_text(size = 16, face = "bold"),
    plot.subtitle = element_text(size = 12),
    plot.caption = element_text(size = 10),
    legend.position = "right"
  )
```

## Histograma

```{r}
#| code-fold: true
#| fig-width: 7
#| fig-align: center

ggplot(datos) +
  geom_histogram(aes(porcentaje_de_la_poblacion_derechohabiente_en_el_imss), 
                 color="black", fill = "olivedrab", 
                 boundary=min(datos$porcentaje_de_la_poblacion_derechohabiente_en_el_imss, 
                             na.rm = TRUE), binwidth = 5) +
  labs(
    title = "Derechohabientes IMSS (%)",
    x = "Derechohabientes (%)", y = "Frecuencia"
  ) +
  theme_bw()+
  theme(
    legend.title = element_text(size=13, face="bold"),
    legend.text = element_text(size=13),
    plot.title = element_text(size=15, face="bold"),
    plot.subtitle = element_text(size=13),
    axis.text.x=element_text(size=12),
    axis.text.y=element_text(size=12),
    axis.title.x = element_text(face="bold", size=13),
    axis.title.y = element_text(face="bold", size=13)
  )
```

# Población total

```{r}
#| code-fold: true
#| fig-width: 8
#| fig-align: center

ggplot(datos) +
  geom_sf(aes(fill = poblacion_total), color = "white", size = 0.1) +
  scale_fill_viridis_c(
    name = "Población",
    trans = "log10",
    labels = scales::comma_format()
  ) +
  labs(
    title = "Población de los Municipios de Michoacán",
    caption = "Fuente: INEGI - Marco Geoestadístico"
  ) +
  theme_void() +
  theme(
    plot.title = element_text(size = 16, face = "bold"),
    plot.subtitle = element_text(size = 12),
    plot.caption = element_text(size = 10),
    legend.position = "right"
  )
```

## Histograma

```{r}
#| code-fold: true
#| fig-width: 7
#| fig-align: center

ggplot(datos) +
  geom_histogram(aes(poblacion_total), color="black", fill = "olivedrab", 
                 boundary=min(datos$poblacion_total, na.rm = TRUE), bins=15) +
  labs(
    title = "Población",
    x = "Población", y = "Frecuencia"
  ) +
  scale_x_log10(breaks = c(5000, 10000, 100000, 1e6), 
                labels = scales::comma_format()) +  
  theme_bw()+
  theme(
    legend.title = element_text(size=13, face="bold"),
    legend.text = element_text(size=13),
    plot.title = element_text(size=15, face="bold"),
    plot.subtitle = element_text(size=13),
    axis.text.x=element_text(size=12),
    axis.text.y=element_text(size=12),
    axis.title.x = element_text(face="bold", size=13),
    axis.title.y = element_text(face="bold", size=13)
  )
```
